<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> 
<html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>User properties Page</title>
        <meta name="description" content="GARO is a real-estate template">
        <meta name="author" content="Kimarotec">
        <meta name="keyword" content="html5, css, bootstrap, property, real-estate theme , bootstrap template">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700,800' rel='stylesheet' type='text/css'>

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
        <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
        <link rel="icon" href="favicon.ico" type="image/x-icon">

        <link rel="stylesheet" href="assets/css/normalize.css">
        <link rel="stylesheet" href="assets/css/font-awesome.min.css">
        <link rel="stylesheet" href="assets/css/fontello.css">
        <link href="assets/fonts/icon-7-stroke/css/pe-icon-7-stroke.css" rel="stylesheet">
        <link href="assets/fonts/icon-7-stroke/css/helper.css" rel="stylesheet">
        <link href="assets/css/animate.css" rel="stylesheet" media="screen">
        <link rel="stylesheet" href="assets/css/bootstrap-select.min.css"> 
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/css/icheck.min_all.css">
        <link rel="stylesheet" href="assets/css/price-range.css">
        <link rel="stylesheet" href="assets/css/owl.carousel.css">  
        <link rel="stylesheet" href="assets/css/owl.theme.css">
        <link rel="stylesheet" href="assets/css/owl.transitions.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/responsive.css">


    </head>
    <body>

        <div id="preloader">
            <div id="status">&nbsp;</div>
        </div>
        <!-- Body content -->

       
        

        <nav class="navbar navbar-default ">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <!-- <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navigation">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="index.html"><img src="assets/img/logo.png" alt=""></a>
                </div> -->

                <!-- Collect the nav links, forms, and other content for toggling -->
                

        <div class="page-head"> 
            <div class="container">
                <div class="row">
                    <div class="page-head-content">
                        <h1 class="page-title">My property</h1> 
                        <p></p>
                        <div align="center" style="float:right; padding-right: 40px;">
    <!-- <a class="navbar-btn nav-button wow bounceInRight login" href="https://frontend-final-proj.s3.amazonaws.com/front-end/testindex/testIndex.html"  >Home Page</a> -->
    <button class="btn btn_top wish_list_btn"
                    type="button" onclick="mainRouter()">Home Page</button>
                    <button class="btn btn_top wish_list_btn"
                    type="button" onclick="submitRouter()">Submit property</button>

        <!-- <a class="navbar-btn nav-button wow bounceInRight login" href="https://frontend-final-proj.s3.amazonaws.com/front-end/testindex/submit-property.html" data-wow-delay="0.4s" >Submit property</a> -->
</div>
                        
                    </div>

                </div>

            </div>
        </div>
        
        <!-- End page header -->

        <!-- property area -->
        
        <div class="content-area recent-property" style="background-color: #FFF;" id="test">
            <!-- <div class="container">   
                <div class="row"> -->

                    <div class="col-md-16   properties-page user-properties">

                       

                        <div class="section"> 
                            <div id="list-type" class="proerty-th-list">
                                                                                        
                            </div>
                        </div>
                        

                        <!-- <div class="section"> 
                            <div class="pull-right">
                                <div class="pagination">
                                    <ul>
                                        <li><a href="#">Prev</a></li>
                                        <li><a href="#">1</a></li>
                                        <li><a href="#">2</a></li>
                                        <li><a href="#">3</a></li>
                                        <li><a href="#">4</a></li>
                                        <li><a href="#">Next</a></li>
                                    </ul>
                                </div>
                            </div>                
                        </div> -->

                   <!--  </div>       

                    
                </div> -->
            </div>
        </div>

           

       
          

        <script src="assets/js/modernizr-2.6.2.min.js"></script>
        <script src="assets/js/jquery-1.10.2.min.js"></script>
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/bootstrap-select.min.js"></script>
        <script src="assets/js/bootstrap-hover-dropdown.js"></script>
        <script src="assets/js/easypiechart.min.js"></script>
        <script src="assets/js/jquery.easypiechart.min.js"></script>
        <script src="assets/js/owl.carousel.min.js"></script>
        <script src="assets/js/wow.js"></script>
        <script src="assets/js/icheck.min.js"></script>

        <script src="assets/js/price-range.js"></script> 
        <script src="assets/js/jquery.bootstrap.wizard.js" type="text/javascript"></script>
        <script src="assets/js/jquery.validate.min.js"></script>
        <script src="assets/js/wizard.js"></script>

        <script type="text/javascript" src="lib/axios/dist/axios.standalone.js"></script>
        <script type="text/javascript" src="lib/CryptoJS/rollups/hmac-sha256.js"></script>
        <script type="text/javascript" src="lib/CryptoJS/rollups/sha256.js"></script>
        <script type="text/javascript" src="lib/CryptoJS/components/hmac.js"></script>
        <script type="text/javascript" src="lib/CryptoJS/components/enc-base64.js"></script>
        <script type="text/javascript" src="lib/url-template/url-template.js"></script>
        <script type="text/javascript" src="lib/apiGatewayCore/sigV4Client.js"></script>
        <script type="text/javascript" src="lib/apiGatewayCore/apiGatewayClient.js"></script>
        <script type="text/javascript" src="lib/apiGatewayCore/simpleHttpClient.js"></script>
        <script type="text/javascript" src="lib/apiGatewayCore/utils.js"></script>
        <script type="text/javascript" src="apigClient.js"></script>
        <script src="https://sdk.amazonaws.com/js/aws-sdk-2.418.0.min.js"></script>
    <script type="text/javascript" src="js/userDealer.js"></script>

        <script src="assets/js/main.js"></script>
        <script>
            var noApplicationRecord = document.getElementById('list-type')
            var apigClient = apigClientFactory.newClient({
                accessKey: 'AKIAS7DTXGU5YMMQ3VXG',
                secretKey: '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'
             });
            
            function deleteItem(item){
                var uid=item.id.trim().split(" ")[0];
                var aptid=item.id.trim().split(" ")[1];
                

                var removeObj = document.getElementById(item.id)
                removeObj.parentNode.removeChild(removeObj);

                var params = {
                    'Origin' : "https://frontend-hw3.s3.amazonaws.com",
                };
                var body = {
                    
                };
                var additionalParams = {
                    queryParams:{
                        'uid': uid,
                        'aptid': aptid
                    }
                };

                apigClient.deletepropertyGet(params, body, additionalParams)
                   .then( function(result){
                        console.log(result);
                        

                    }).catch( function(result){
                       //Add error callback code here.
                      res = "Sorry, API Gateway is not responding";
                });
            }
            

            function setDiv(item,uid){
                
                var div ='<div class="col-md-4 p0" id="'+uid+' '+item.aptid+'">'
                    +'<div class="box-two proerty-item">'+
                        '<div class="item-thumb">'+
                            '<a href="property-1.html" ><img src="'+item.images[0]+'"></a>'+
                        '</div>'+
                        '<div class="item-entry overflow">'+
                            '<h5><a href="property-1.html"> '+item.street+' '+item.city+' '+item.state+'</a></h5>'
                            +'<div class="dot-hr"></div>'+
                            '<span class="proerty-price pull-right"> $'+ item.rentzestimate+'</span>'+
                            '<p style="display: none;">'+item.homeDescription.substr(0,100)+'...</p>'+
                            '<div class="property-icon">'+
                                '<img src="assets/img/icon/bed.png">'+parseInt(item.bedrooms)+'|'+
                                '<img src="assets/img/icon/shawer.png">'+parseInt(item.bathrooms)+'|'+
                                  

                                '<div class="dealer-action pull-right">   '+                                     
                                    '<a href="#" class="button delete_user_car" id="'+uid+' '+item.aptid+'" onClick=deleteItem(this)>Delete</a>'+
                                    
                                '</div></div></div></div></div> '    
                
                return div
            }
            
            function getnoApplicationData(){
                var id_token = location.toString().split('id_token=')[1].split('&access_token=')[0];
                var access_token = location.toString().split('&access_token=')[1].split('&')[0];
                var email;
                let token = {
                    AccessToken: access_token /* required */
                };
                cognitoidentityserviceprovider = new AWS.CognitoIdentityServiceProvider();
                cognitoidentityserviceprovider.getUser(token, function(err, data) {
                    email = data['UserAttributes'][3]['Value'];
                    
                    var params = {
                        'Origin' : "https://frontend-hw3.s3.amazonaws.com",
                    };
                    var body = {
                        
                    };
                    console.log(email)
                    var additionalParams = {
                        queryParams:{
                            'uid': email
                        }
                    };
                    var res;
                    var uid;
                    apigClient.propertyGet(params, body, additionalParams)
                       .then( function(result){
                            // console.log(result);
                            uid = result['data']['uid'];
                            res = result['data']["property"];
                            var html = '';
                            console.log(res.length)
                            for(var i = 0;i<res.length;i++){

                                html += setDiv(res[i],uid)
                                
                            }
                            noApplicationRecord.innerHTML = html;

                        }).catch( function(result){
                           //Add error callback code here.
                          res = "Sorry, API Gateway is not responding";
                    });
                
                })
                
 
                
            }

             window.onload = getnoApplicationData()
        </script>

    </body>
</html>